<div class="calendar-view w-100 flex flex-row items-end">
    <div class="w-[100px] py-[0.625rem] mb-[2px] flex flex-col gap-0 justify-evenly overflow-hidden relative items-center" [style.height]="calendarConfig.calendarColHeight - 2 * calendarConfig.calendarLineHeight + 'px'">
        @for (time of timeLabels; track $index) {
            <p class="text-sm m-0 text-right w-full">{{ time }}</p>
        }
    </div>

    @if (weekDates.length > 0) {
        @for (date of weekDates; track $index) {
            <app-calendar-col [modalHandlers]="modalHandlers" [type]="type" [date]="date" [calendarConfig]="calendarConfig" class="flex flex-1" />
        }
    }
</div>
@if (type == 'plan') {

    <!-- add new session modal -->
    <p-dialog header="Add New Session" [(visible)]="displayAddModal" [modal]="true" [closable]="true" [style]="{ width: '400px' }">
        <form [formGroup]="sessionForm" (ngSubmit)="submitAddForm()" class="p-fluid">
            <div class="field items-center flex my-5 gap-5">
                <label for="startTime">Start Time</label>
                <input id="startTime" type="time" pInputText formControlName="startTime" />
            </div>

            <div class="field flex items-center my-5 gap-5">
                <label for="endTime">End Time</label>
                <input id="endTime" type="time" pInputText formControlName="endTime" />
            </div>

            <div class="field flex items-center my-5 gap-5">
                <label for="numPatients">Number of Patients</label>
                <input id="numPatients" type="number" pInputText formControlName="numPatients" min="1" />
            </div>

            <div class="flex justify-end mt-4 gap-6">
                <p-button label="Discard" severity="warn" icon="pi pi-times" (click)="displayAddModal = false" class="p-button-text mr-2" />
                <p-button label="Save" icon="pi pi-check" type="submit" [disabled]="sessionForm.invalid" />
            </div>
        </form>
    </p-dialog>

    <!-- edit session modal -->
    <p-dialog header="Edit Session" [(visible)]="displayEditModal" [modal]="true" [closable]="true" [style]="{ width: '400px' }">
        <form [formGroup]="sessionForm" (ngSubmit)="submitEditForm()" class="p-fluid">
            <div class="field items-center flex my-5 gap-5">
                <label for="startTime">Start Time</label>
                <input id="startTime" type="time" pInputText formControlName="startTime" />
            </div>

            <div class="field flex items-center my-5 gap-5">
                <label for="endTime">End Time</label>
                <input id="endTime" type="time" pInputText formControlName="endTime" />
            </div>
            <div class="field flex items-center my-5 gap-5">
                <label for="numPatients">Number of Patients</label>
                <input id="numPatients" type="number" pInputText formControlName="numPatients" min="1" />
            </div>
            <div class="flex justify-end mt-4 gap-6">
                <p-button label="Discard" severity="warn" icon="pi pi-times" (click)="displayEditModal = false" class="p-button-text mr-2" />
                <p-button label="Save" icon="pi pi-check" type="submit" [disabled]="sessionForm.invalid" />
            </div>
        </form>
    </p-dialog>

    <!-- delete session confirmation modal -->
    <p-dialog header="Confirmation" [(visible)]="displayDeleteModal" [style]="{ width: '350px' }" [modal]="true">
        <div class="flex items-center justify-center">
            <i class="pi pi-exclamation-triangle mr-4" style="font-size: 2rem"> </i>
            <span>Are you sure you want to delete this session?</span>
        </div>
        <ng-template #footer>
            <p-button label="No" icon="pi pi-times" (click)="displayDeleteModal = false" text severity="secondary" />
            <p-button label="Yes" icon="pi pi-check" (click)="deleteSession()" severity="danger" outlined autofocus />
        </ng-template>
    </p-dialog>
}
